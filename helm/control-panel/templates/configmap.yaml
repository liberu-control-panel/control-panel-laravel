apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "control-panel.fullname" . }}-config
  labels:
    {{- include "control-panel.labels" . | nindent 4 }}
data:
  APP_ENV: {{ .Values.app.env | quote }}
  APP_DEBUG: {{ .Values.app.debug | quote }}
  APP_URL: {{ .Values.app.url | quote }}
  LOG_CHANNEL: "stack"
  LOG_LEVEL: {{ if eq .Values.app.env "production" }}"warning"{{ else }}"debug"{{ end }}
  
  DB_CONNECTION: "mysql"
  {{- if .Values.mysql.enabled }}
  DB_HOST: {{ include "control-panel.mysql.fullname" . | quote }}
  DB_PORT: "3306"
  DB_DATABASE: {{ .Values.mysql.auth.database | quote }}
  {{- end }}
  
  CACHE_DRIVER: {{ if .Values.redis.enabled }}"redis"{{ else }}"file"{{ end }}
  QUEUE_CONNECTION: {{ if .Values.redis.enabled }}"redis"{{ else }}"sync"{{ end }}
  SESSION_DRIVER: {{ if .Values.redis.enabled }}"redis"{{ else }}"file"{{ end }}
  
  {{- if .Values.redis.enabled }}
  REDIS_HOST: {{ include "control-panel.redis.fullname" . | quote }}
  REDIS_PORT: "6379"
  {{- end }}
  
  KUBERNETES_ENABLED: {{ .Values.kubernetes.enabled | quote }}
  KUBECTL_PATH: {{ .Values.kubernetes.kubectlPath | quote }}
  KUBERNETES_NAMESPACE_PREFIX: {{ .Values.kubernetes.namespacePrefix | quote }}
  KUBERNETES_INGRESS_CLASS: {{ .Values.kubernetes.ingressClass | quote }}
  KUBERNETES_CERT_ISSUER: {{ .Values.kubernetes.certIssuer | quote }}
  KUBERNETES_STORAGE_CLASS: {{ .Values.kubernetes.storageClass | quote }}
  
  SSH_TIMEOUT: {{ .Values.ssh.timeout | quote }}
  SSH_RETRY_ATTEMPTS: {{ .Values.ssh.retryAttempts | quote }}
  SSH_RETRY_DELAY: {{ .Values.ssh.retryDelay | quote }}
